<%- include('../includes/header.ejs') %>
    <link rel="stylesheet" href="/css/projects.css">

    </head>

    <body>
        <% const money = new Intl.NumberFormat('en-US', {style: 'currency',currency: 'USD',minimumFractionDigits: 2}); %>
            <% const percent = new Intl.NumberFormat('en-US', {style: 'percent',minimumFractionDigits: 1}); %>
                <%- include('../includes/navigation.ejs') %>
                    <main><br><br><br>
                        <!-- Status Section -->
                        <div class="container">
                            <input type="hidden" name="projectId" value="<%= project.id %>">
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                            <h5> Project Status: </h5>
                            <% if (project.statusId === 1) { %>
                                <button class="btn-sm" type="button" disabled>Entry</button>
                                <% } else { %>
                                    <a href="/statusChg/<%= project.id %>/1/Entry" class="btnsm1">Entry</a>
                                    <% } %>
                                        <% if (project.statusId === 2) { %>
                                            <button class="btn-sm" type="button" disabled>Estimating</button>
                                            <% } else { %>
                                                <a href="/statusChg/<%= project.id %>/2/Estimating" class="btnsm1">Estimating</a>
                                                <% } %>
                                                    <% if (project.statusId === 3) { %>
                                                        <button class="btn-sm" type="button" disabled>Production</button>
                                                        <% } else { %>
                                                            <a href="/statusChg/<%= project.id %>/3/Production" class="btnsm1">Production</a>
                                                            <% } %>
                                                                <% if (project.statusId === 4) { %>
                                                                    <button class="btn-sm" type="button" disabled>Awaiting Inspection</button>
                                                                    <% } else { %>
                                                                        <a href="/statusChg/<%= project.id %>/4/Awaiting Inspection" class="btnsm1">Awaiting Inspection</a>
                                                                        <% } %>
                                                                            <% if (project.statusId === 5) { %>
                                                                                <button class="btn-sm" type="button" disabled>Close-Out</button>
                                                                                <% } else { %>
                                                                                    <a href="/statusChg/<%= project.id %>/5/Close-Out" class="btnsm1">Close Out</a>
                                                                                    <% } %>
                                                                                        <% if (project.statusId === 6) { %>
                                                                                            <button class="btn-sm" type="button" disabled>Completed</button>
                                                                                            <% } else { %>
                                                                                                <a href="/statusChg/<%= project.id %>/6/Completed" class="btnsm1">Completed</a>
                                                                                                <% } %>
                                                                                                    <% if (project.statusId === 7) { %>
                                                                                                        <button class="btn-sm" type="button" disabled>Collections</button>
                                                                                                        <% } else { %>
                                                                                                            <a href="/statusChg/<%= project.id %>/7/Collections" class="btnsm1">Collections</a>
                                                                                                            <% } %>
                                                                                                                <% if (project.statusId === 8) { %>
                                                                                                                    <button class="btn-sm" type="button" disabled>Canceled</button>
                                                                                                                    <% } else { %>
                                                                                                                        <a href="/statusChg/<%= project.id %>/8/Canceled" class="btnsm1">Canceled</a>
                                                                                                                        <% } %>
                                                                                                                            <% if (project.statusId === 9) { %>
                                                                                                                                <button class="btn-sm" type="button" disabled>Denied</button>
                                                                                                                                <% } else { %>
                                                                                                                                    <a href="/statusChg/<%= project.id %>/9/Denied" class="btnsm1">Denied</a>
                                                                                                                                    <% } %>
                                                                                                                                        <% if (project.statusId === 10) { %>
                                                                                                                                            <button class="btn-sm" type="button" disabled>On Hold</button>
                                                                                                                                            <% } else { %>
                                                                                                                                                <a href="/statusChg/<%= project.id %>/10/On Hold" class="btnsm1">On Hold</a>
                                                                                                                                                <% } %>
                        </div>
                        <br>
                        <!-- Owner Information Section -->
                        <div class="container">
                            <% if (!project.commercial) { %>
                                <div class="d-flex w-100 justify-content-between">
                                    <h5 class="mb-1">
                                        <strong> <% if (!project.owner2Fn) { %>
                        <%= project.owner1Fn %>
                        <%= project.owner1Ln %>
                        <% } else { %>
                        <% if (project.owner1Ln === project.owner2Ln) { %>
                        <%= project.owner1Fn %><span> & </span>
                        <%= project.owner2Fn %><span> </span>
                        <%= project.owner1Ln %>
                        <% } else { %>
                        <%= project.owner1Fn %>
                        <%= project.owner1Ln %><span> & </span>
                        <%= project.owner2Fn %>
                        <%= project.owner2Ln %>
                        <% } %>
                        <% } %></strong>
                                    </h5>
                                    <small></small>
                                </div>
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">
                                        <strong> <%= project.address %>,
                        <%= project.city %>,
                        <%= project.state %>
                        <%= project.zip %></strong>
                                    </h6>
                                </div>
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">
                                        Home Phone: (
                                        <strong><%= project.hPhone.substring(0,3) %> )
                        <%= project.hPhone.substring(3, 6) %>-
                        <%= project.hPhone.substring(6, 10) %></strong>
                                        <br> Cell Phone: (
                                        <strong><%= project.cPhone.substring(0,3) %> )
                        <%= project.cPhone.substring(3, 6) %>-
                        <%= project.cPhone.substring(6, 10) %></strong><br> Other Phone: (
                                        <strong><%= project.oPhone.substring(0,3) %> )
                        <%= project.oPhone.substring(3, 6) %>-
                        <%= project.oPhone.substring(6, 10) %></strong><br> Email:
                                        <strong><%= project.email %></strong><br><br>
                                        <a href="/ownerInfo/<%= project.id %>" class="btn-sm">Edit Owner Information</a>
                                    </h6>
                                </div>
                                <!-- Comercial Proerties -->
                                <% } else { %>
                                    <div class="d-flex w-100 justify-content-between">
                                        <div class="col1">
                                            <h6 class="mb-1">
                                                <strong><h5><%= project.bName %></strong></h5>
                                                <strong> <%= project.bAddress %>,
                                        <%= project.bCity %>,
                                        <%= project.bState %>
                                        <%= project.bZip %></strong></h6>
                                            <br>
                                            <strong><h5>Property Owner</h5></strong> Company Name:<strong> <%= project.ownerCoName %></strong>
                                            <br> Owner Name:<strong><%= project.owner1Fn %> 
                                                <%= project.owner1Ln %></strong>
                                            <br> Address:
                                            <strong> <%= project.address %>,
                                    <%= project.city %>,
                                    <%= project.state %>
                                    <%= project.zip %></strong>
                                            <br> Phone 1:<strong>
                                        <% if (!project.hPhone) { %>
                                        No Number Entered </strong>
                                            <% } else { %>(
                                                <%= project.hPhone.substring(0,3) %> )
                                                    <%= project.hPhone.substring(3, 6) %>-
                                                        <%= project.hPhone.substring(6, 10) %>
                                                            </Strong>
                                                            <% } %>
                                                                <br> Phone 2:
                                                                <strong><% if (!project.cPhone) { %>
                        No Number Entered</strong>
                                                                <% } else { %>(
                                                                    <%= project.cPhone.substring(0,3) %> )
                                                                        <%= project.cPhone.substring(3, 6) %>-
                                                                            <%= project.cPhone.substring(6, 10) %>
                                                                                </strong>
                                                                                <% } %>
                                                                                    <br> Phone 3:
                                                                                    <strong><% if (!project.oPhone) { %>
                        No Number Entered</strong>
                                                                                    <% } else { %>(
                                                                                        <%= project.oPhone.substring(0,3) %> )
                                                                                            <%= project.oPhone.substring(3, 6) %>-
                                                                                                <%= project.oPhone.substring(6, 10) %>
                                                                                                    </strong>
                                                                                                    <% } %>
                                                                                                        <br> Email:
                                                                                                        <strong><%= project.email %></strong><br>
                                        </div>
                                        <div class="col2">
                                            <h5><strong>Property Management Co.</strong></h5>
                                            <h6 class="mb-1">
                                            </h6><br> Company Name:<strong> <%= project.pmCoName %></strong><br> Contact Name:<strong>
                        <%= project.pmContact %></strong><br> Address:
                                            <strong> <%= project.pmAddress %>,
                        <%= project.pmCity %>,
                        <%= project.pmState %>
                        <%= project.pmZip %></strong><br> Phone 1:
                                            <strong><% if (!project.pmPhon1) { %>
                        No Number Entered </strong>
                                            <% } else { %>(
                                                <%= project.pmPhon1.substring(0,3) %> )
                                                    <%= project.pmPhon1.substring(3, 6) %>-
                                                        <%= project.pmPhon1.substring(6, 10) %>
                                                            </strong>
                                                            <% } %>
                                                                <br> Phone 2:
                                                                <strong><% if (!project.pmPhone2) { %>
                        No Number Entered </strong>
                                                                <% } else { %>(
                                                                    <%= project.pmPhone2.substring(0,3) %> )
                                                                        <%= project.pmPhone2.substring(3, 6) %>-
                                                                            <%= project.pmPhone2.substring(6, 10) %>
                                                                                </strong>
                                                                                <% } %><br> Email:
                                                                                    <strong><%= project.pmEmail %></strong>
                                                                                    <br>
                                                                                    <br>
                                                                                    <a href="/ownerInfoC/<%= project.id %>" class="btn-sm">Edit Owner Information</a>
                                        </div>
                                    </div>
                                    <% } %>
                                        <br>
                                        <hr class="thick">

                                        <!-- General Information Section -->

                                        <div class="row">
                                            <div class="col-sm">
                                                <h5>General Information</h5>
                                            </div>
                                            <div class="col-sm">
                                                <h6>Job:
                                                    <strong><%= project.id %></strong> - Project:
                                                    <strong><%= project.projectNo %></strong>
                                                </h6>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm">
                                                Sales Rep: <strong><%= project.sale.name %></strong>
                                            </div>
                                            <div class="col-sm">
                                                Project Manager: <strong><%= project.supervisor.name %></strong>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-sm">
                                                Date Entered:
                                                <strong><%= project.entDate.substring(5, 7) %>/<%= project.entDate.substring(8, 10) %>/<%= project.entDate.substring(0,4) %></strong>

                                            </div>
                                            <div class="col-sm">
                                                <% if (!project.compDate) { %>
                                                    Date Completed:<strong> N/A</strong>
                                                    <% } else { %>
                                                        Date Completed:
                                                        <strong><%= project.compDate.substring(5, 7) %>/<%= project.compDate.substring(8, 10) %>/<%= project.compDate.substring(0,4) %></strong>
                                                        <% } %>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm">
                                                <% if (!project.estDate) { %>
                                                    Date to Estimating: <strong>N/A</strong>
                                                    <% } else { %>
                                                        Date to Estimating:
                                                        <strong><%= project.estDate.substring(5, 7) %>/<%= project.estDate.substring(8, 10) %>/<%= project.estDate.substring(0,4) %></strong>
                                                        <% } %>
                                            </div>
                                            <div class="col-sm">
                                                <% if (!project.collectDate) { %>
                                                    Date to Collections:<strong> N/A</strong>
                                                    <% } else { %>
                                                        Date to Collection:<strong>
                                <%= project.collectDate.substring(5, 7) %>/<%= project.collectDate.substring(8, 10) %>/<%= project.collectDate.substring(0,4) %></strong>
                                                        <% } %>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm">
                                                <% if (!project.prodDate) { %>
                                                    Date to Production:<strong> N/A</strong>
                                                    <% } else { %>
                                                        Date to Production:<strong>
                                <%= project.prodDate.substring(5, 7) %>/<%= project.prodDate.substring(8, 10) %>/<%= project.prodDate.substring(0,4) %></strong>
                                                        <% } %>
                                            </div>
                                            <div class="col-sm">
                                                <% if (!project.cancelDate) { %>
                                                    Date Canceled:<strong> N/A</strong>
                                                    <% } else { %>
                                                        Date Canceled:<strong>
                                <%= project.cancelDate.substring(5, 7) %>/<%= project.cancelDate.substring(8, 10) %>/<%= project.cancelDate.substring(0,4) %></strong>
                                                        <% } %>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm">
                                                <% if (!project.wfiDate) { %>
                                                    Date to Awaiting:<strong> N/A</strong>
                                                    <% } else { %>
                                                        Date to Awaiting:<strong>
                                <%= project.aiDate.substring(5, 7) %>/<%= project.aiDate.substring(8, 10) %>/<%= project.aiDate.substring(0,4) %></strong>
                                                        <% } %>
                                            </div>
                                            <div class="col-sm">
                                                <% if (!project.denyDate) { %>
                                                    Date Denied:<strong> N/A</strong>
                                                    <% } else { %>
                                                        Date Denied:<strong>
                                <%= project.denyDate.substring(5, 7) %>/<%= project.denyDate.substring(8, 10) %>/<%= project.denyDate.substring(0,4) %></strong>
                                                        <% } %>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm">
                                                <% if (!project.closeDate) { %>
                                                    Date to Close Out:<strong> N/A</strong>
                                                    <% } else { %>
                                                        Date to Close Out:<strong>
                                <%= project.closeDate.substring(5, 7) %>/<%= project.closeDate.substring(8, 10) %>/<%= project.closeDate.substring(0,4) %></strong>
                                                        <% } %>
                                            </div>
                                            <div class="col-sm">
                                                <% if (!project.holdDate) { %>
                                                    Date put on Hold:<strong> N/A</strong>
                                                    <% } else { %>
                                                        Date put on Hold:
                                                        <strong><%= project.holdDate.substring(5, 7) %>/<%= project.holdDate.substring(8, 10) %>/<%= project.holdDate.substring(0,4) %></strong>
                                                        <% } %>
                                            </div>
                                        </div>
                                        <br>
                                        <a href="/generalInfo/<%= project.id %>" class="btn-sm">Edit General Information</a>
                                        <a href="/add-doc/<%= project.id %>" class="btn-sm">Documents</a>


                                        <br>
                                        <br>
                                        <hr class="thick">
                                        <!-- Insurance Information Section -->
                                        <h5><strong>Insurance Company: </strong>
                                            <%= project.insurance.coName %>
                                        </h5>
                                        <br>
                                        <div class="row">
                                            <div class="col-sm">
                                                Policy #: <strong><%= project.policyNo %></strong>
                                            </div>

                                            <div class="col-sm">
                                                Claim #: <strong><%= project.claimNo %></strong>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm">
                                                Date of Loss: <strong><%= project.dateLoss %></strong>
                                            </div>
                                            <div class="col-sm">Type of Loss: <strong><%= project.typeLoss %></strong>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm">
                                                Original Scope Date:
                                                <% if (!project.oScopeDate) { %>
                                                    <strong>Not Recieved</strong></div>
                                            <% } else { %>
                                                <strong><%= project.oScopeDate.substring(5, 7) %>/<%= project.oScopeDate.substring(8, 10) %>/<%= project.oScopeDate.substring(0,4) %></strong>
                                        </div>
                                        <div class="col-sm">
                                            Oringinal Scope RCV:
                                            <strong><%= money.format(project.oScopeRCV) %></strong>
                                        </div>
                                        <% } %>
                                            <div class="row">
                                                <div class="col-sm">
                                                    Final Scope Date:
                                                    <% if (!project.fScopeDate) { %>
                                                        <strong>Not Recieved</strong></div>
                                                <% } else { %>
                                                    <strong><%= project.fScopeDate.substring(5, 7) %>/<%= project.fScopeDate.substring(8, 10) %>/<%= project.fScopeDate.substring(0,4) %></strong>
                                            </div>
                                            <div class="col-sm">
                                                Final Scope RCV:
                                                <strong><%= money.format(project.fScopeRCV) %></strong>
                                            </div>
                                            <% } %>
                        </div>
                        <div class="row">
                            <div class="col-sm">
                                Adjuster's Name: <strong><%= project.adjName %></strong>
                            </div>
                            <div class="col-sm">
                                Adjuster's Phone: <strong>( <%= project.adjPhone.substring(0,3) %>
                        )<%= project.adjPhone.substring(3, 6) %>-<%= project.adjPhone.substring(6, 10) %></strong>
                            </div>
                        </div>
                        <br>
                        <a href="/insuranceInfo/<%= project.id %>" class="btn-sm">Edit Insurance Information</a>
                        <br>
                        <br>
                        <hr class="thick">
                        <!-- Finaincial Information Section -->

                        <h5><strong>Financial Information</strong></h5>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th scope='col'>Total Project</th>
                                    <th scope='col'>Amount</th>
                                    <th scope='col'> </th>
                                    <th scope='col'>Projected Profit</th>
                                    <th scope='col'>Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Original Scope RCV:</td>
                                    <td><strong><%= money.format(project.oScopeRCV) %></strong></td>
                                    <td> </td>
                                    <td><a href="/fundsReceived/<%= project.id %>" class="btn-sm2">Funds Received:</a></td>
                                    <td><strong><%= money.format(project.totalFundsRcvd) %></strong></td>
                                </tr>
                                <tr>
                                    <td>Final Scope RCV:</td>
                                    <td><strong><%= money.format(project.fScopeRCV) %></strong></td>
                                    <td> </td>
                                    <td><a href="/jobCosts/<%= project.id %>" class="btn-sm2">Job Costs:</a></td>
                                    <td><strong><%= money.format(project.totalJobCosts) %></strong></td>
                                </tr>
                                <tr>
                                    <td>Gross Supplement:</td>
                                    <td><strong><% if (project.fScopeRCV == null) { %>
                                        <%= money.format(project.fScopeRCV) %>
                                        <% } else { %>
                                            <%= money.format((project.fScopeRCV - project.oScopeRCV)) %>
                                            <% } %>
                                                </strong>
                                    </td>
                                    <td> </td>
                                    <td>
                                        <% if (!project.commercial) { %>
                                            <a href="/comEdit/<%= project.id %>" class="btn-sm2">Total Commissions:</a>
                                            <% } else { %>
                                                <a href="/comEditC/<%= project.id %>" class="btn-sm2">Total Commissions:   </a>
                                                <% } %>
                                    </td>
                                    <td>
                                        <% if (!project.commercial) { %>
                                            <strong><%= money.format(project.totalRepPay) %></strong>
                                            <% } else { %>
                                                <strong><%= money.format(project.totalRepPay) %></strong>
                                                <% } %>
                                                    </strong>
                                    </td>
                                </tr>
                                <tr>
                                    <td><a href="/additions/<%= project.id %>" class="btn-sm2">Additions:</a></td>
                                    <td><strong><%= money.format(project.rcvChange) %></strong></td>
                                    <td> </td>
                                    <td>Gross Profit $:</td>
                                    <td><strong><%= money.format((project.totalFundsRcvd - project.totalJobCosts - project.totalRepPay)) %></strong></td>
                                </tr>
                                <tr>
                                    <td><a href="/exclusions/<%= project.id %>" class="btn-sm2">Exclusions:</a></td>
                                    <td><strong><%= money.format(project.totalExclusions) %></strong></td>
                                    <td> </td>
                                    <td>Gross Profit %:</td>
                                    <td><strong><%= percent.format(((project.totalFundsRcvd - project.totalJobCosts - project.totalRepPay)/project.totalFundsRcvd)) %></strong></td>
                                </tr>
                                <tr>
                                    <td><a href="/ownerOop/<%= project.id %>" class="btn-sm2">Owner Out of Pocket:</a></td>
                                    <td><strong><%= money.format(project.totalOwnerOop) %></strong></td>
                                    <td> </td>
                                    <td>Owner Owes:</td>
                                    <td>
                                        <% if (project.fScopeRCV == null) { %>
                                            <strong><%= money.format(((project.oScopeRCV + project.rcvChange - project.totalExclusions + project.totalOwnerOop) - project.totalFundsRcvd)) %></strong>
                                            <% } else { %>
                                                <strong><%= money.format(((project.fScopeRCV + project.rcvChange - project.totalExclusions + project.totalOwnerOop) - project.totalFundsRcvd)) %></strong>
                                                <% } %>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Total Project:</td>
                                    <td><strong><% if (project.fScopeRCV == null) { %>
                                    <%= money.format(project.oScopeRCV + project.rcvChange - project.totalExclusions + project.totalOwnerOop) %>
                                        <% } else { %>
                                            <%= money.format(project.fScopeRCV + project.rcvChange - project.totalExclusions + project.totalOwnerOop) %>
                                            <% } %>
                                                </strong>
                                    </td>
                                    <td> </td>
                                    <td> </td>
                                    <td> </td>
                                </tr>

                            </tbody>
                        </table>
                        <hr class="thick">
                        <!-- Work to be done section -->

                        <h5><strong>Production</strong></h5>
                        <div class="row">
                            <a href="/wtb/<%= project.id %>" class="btn-sm">Scope Lines</a>
                            <a href="/wtbTot/<%= project.id %>" class="btn-sm">Budget By Trade</a>
                            <a href="/roofCalc/<%= project.id %>" class="btn-sm">Roof Calculator</a>
                            <a href="/add-workOrder/<%= project.id %>" class="btn-sm">Add Work Order</a>
                            <a href="/workOrderTot/<%= project.id %>" class="btn-sm">Work Orders</a>

                        </div>
                        <br>
                        <hr class="thick">
                        <h5><strong>Project Notes</strong></h5>
                        <a href="/add-note/<%= project.id %>" class="btn-sm">Add Note</a>
                        <br>
                        <!-- <div class="d-flex w-100 justify-content-between"> -->
                        <br>
                        <div class="form-row">
                            <ul>
                                <% for (let notes of note) { %>
                                    <li>
                                        <%=notes.enteredBy %>
                                            <em><%=notes.entryDate.substring(5, 7) %>/
                                            <%=notes.entryDate.substring(8, 10) %>/
                                                <%=notes.entryDate.substring(0,4) %>: </em>
                                            <%=notes.note %>
                                    </li>
                                    <br>
                                    <% } %>
                            </ul>
                        </div>
                        <!-- </div> -->
                        </article>
                    </main>

                    <%- include('../includes/footer.ejs') %>
                        <script src="/js/status.js"></script>